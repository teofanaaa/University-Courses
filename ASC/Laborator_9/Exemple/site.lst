     1                                  ; Codul de mai jos va deschide un fisier numit "input.txt" din directorul curent si va citi intregul text din acel fisier, in etape, cate 100 de caractere intr-o etapa.
     2                                  ; Deoarece un fisier text poate fi foarte lung, nu este intotdeauna posibil sa citim fisierul intr-o singura etapa pentru ca nu putem defini un sir de caractere suficient de lung pentru intregul text din fisier. De 
     3                                  ; Programul va folosi functia fopen pentru deschiderea fisierului, functia fread pentru citirea din fisier si functia fclose pentru inchiderea fisierului creat.
     4                                  ; Deoarece in apelul functiei fopen programul foloseste modul de acces "r", daca un fisier numele dat nu exista in directorul curent,  apelul functiei fopen nu va reusi (eroare). Detalii despre modurile de acces sun
     5                                  
     6                                  bits 32 
     7                                  
     8                                  global start        
     9                                  
    10                                  ; declare external functions needed by our program
    11                                  extern exit, fopen, fclose, fread
    12                                  import exit msvcrt.dll 
    13                                  import fopen msvcrt.dll 
    14                                  import fread msvcrt.dll 
    15                                  import fclose msvcrt.dll 
    16                                  
    17                                  ; our data is declared here 
    18                                  segment data use32 class=data
    19 00000000 696E7075742E747874-         nume_fisier db "input.txt", 0   ; numele fisierului care va fi deschis
    19 00000009 00                 
    20 0000000A 7200                        mod_acces db "r", 0             ; modul de deschidere a fisierului; r - pentru scriere. fisierul trebuie sa existe 
    21 0000000C FFFFFFFF                    descriptor_fis dd -1            ; variabila in care vom salva descriptorul fisierului - necesar pentru a putea face referire la fisier
    22 00000010 00000000                    nr_car_citite dd 0              ; variabila in care vom salva numarul de caractere citit din fisier in etapa curenta
    23                                      len equ 100                     ; numarul maxim de elemente citite din fisier intr-o etapa
    24 00000014 <res 00000064>              buffer resb len                 ; sirul in care se va citi textul din fisier
    25                                  
    26                                  ; our code starts here
    27                                  segment code use32 class=code
    28                                      start:
    29                                          ; apelam fopen pentru a deschide fisierul
    30                                          ; functia va returna in EAX descriptorul fisierului sau 0 in caz de eroare
    31                                          ; eax = fopen(nume_fisier, mod_acces)
    32 00000000 68[0A000000]                    push dword mod_acces
    33 00000005 68[00000000]                    push dword nume_fisier
    34 0000000A FF15[00000000]                  call [fopen]
    35 00000010 83C408                          add esp, 4*2
    36                                          
    37                                          ; verificam daca functia fopen a creat cu succes fisierul (daca EAX != 0)
    38 00000013 83F800                          cmp eax, 0                  
    39 00000016 7438                            je final
    40                                          
    41 00000018 A3[0C000000]                    mov [descriptor_fis], eax   ; salvam valoarea returnata de fopen in variabila descriptor_fis
    42                                          
    43                                          ; echivalentul in pseudocod al urmatoarei secvente de cod este:
    44                                          ;repeta
    45                                          ;   nr_car_citite = fread(buffer, 1, len, descriptor_fis)
    46                                          ;   daca nr_car_citite > 0
    47                                          ;       ; instructiuni pentru procesarea caracterelor citite in aceasta etapa
    48                                          ;pana cand nr_car_citite == 0
    49                                          
    50                                          bucla:
    51                                              ; citim o parte (100 caractere) din textul in fisierul deschis folosind functia fread
    52                                              ; eax = fread(buffer, 1, len, descriptor_fis)
    53 0000001D FF35[0C000000]                      push dword [descriptor_fis]
    54 00000023 6A64                                push dword len
    55 00000025 6A01                                push dword 1
    56 00000027 68[14000000]                        push dword buffer
    57 0000002C FF15[00000000]                      call [fread]
    58 00000032 83C410                              add esp, 4*4
    59                                              
    60                                              ; eax = numar de caractere / bytes citite
    61 00000035 83F800                              cmp eax, 0          ; daca numarul de caractere citite este 0, am terminat de parcurs fisierul
    62 00000038 7407                                je cleanup
    63                                  
    64 0000003A A3[10000000]                        mov [nr_car_citite], eax        ; salvam numarul de caractere citie
    65                                              
    66                                              ; instructiunile pentru procesarea caracterelor citite in aceasta etapa incep aici
    67                                              ; ...
    68                                              
    69                                              ; reluam bucla pentru a citi alt bloc de caractere
    70 0000003F EBDC                                jmp bucla
    71                                          
    72                                        cleanup:
    73                                          ; apelam functia fclose pentru a inchide fisierul
    74                                          ; fclose(descriptor_fis)
    75 00000041 FF35[0C000000]                  push dword [descriptor_fis]
    76 00000047 FF15[00000000]                  call [fclose]
    77 0000004D 83C404                          add esp, 4
    78                                          
    79                                        final:  
    80                                          ; exit(0)
    81 00000050 6A00                            push    dword 0      
    82 00000052 FF15[00000000]                  call    [exit]       
